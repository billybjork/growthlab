<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>GrowthLab</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/favicon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/favicon-512.png">
    <link rel="apple-touch-icon" href="assets/apple-touch-icon.png">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/sessions.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <!-- Preconnect to Three.js CDN for faster loading -->
    <link rel="preconnect" href="https://unpkg.com">
    <!-- Preload Three.js core (loaded lazily but start fetching early) -->
    <link rel="modulepreload" href="https://unpkg.com/three@0.160.0/build/three.module.js">
</head>
<body class="sessions-page">
    <!-- Three.js Canvas Container -->
    <div id="canvas-container"></div>

    <!-- Gyroscope permission button (iOS only, hidden by default) -->
    <button id="gyro-btn" class="gyro-button" aria-label="Enable motion control">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10"/>
            <circle cx="12" cy="12" r="3" fill="currentColor" stroke="none"/>
            <line x1="12" y1="2" x2="12" y2="6"/>
            <line x1="12" y1="18" x2="12" y2="22"/>
            <line x1="2" y1="12" x2="6" y2="12"/>
            <line x1="18" y1="12" x2="22" y2="12"/>
        </svg>
    </button>

    <!-- Content Overlay -->
    <div class="sessions-content">
        <!-- Presented by header -->
        <header class="sessions-header">
            <div class="presented-by">
                <span class="presented-by-text">Presented by</span>
                <img src="media/index/growthassistant-logo.png" alt="GrowthAssistant" class="ga-logo">
            </div>
        </header>

        <!-- Session List -->
        <main class="sessions-list">
            <h2>Sessions</h2>
            <ul>
                <li>
                    <a href="session.html?file=session-01">
                        <span class="session-number">01</span>
                        <span class="session-title">Introductions, AI Frontiers & Course Foundations</span>
                        <span class="session-arrow">→</span>
                    </a>
                </li>
                <li>
                    <a href="session.html?file=session-02">
                        <span class="session-number">02</span>
                        <span class="session-title">How AI Reshapes Creative Control</span>
                        <span class="session-arrow">→</span>
                    </a>
                </li>
                <li>
                    <a href="session.html?file=session-03">
                        <span class="session-number">03</span>
                        <span class="session-title">AI-Enhanced Rapid Prototyping & Workflow Design</span>
                        <span class="session-arrow">→</span>
                    </a>
                </li>
            </ul>
        </main>
    </div>

    <!-- Keyboard navigation -->
    <script>
    (function() {
        let selectedIndex = -1;
        const getItems = () => document.querySelectorAll('.sessions-list li');

        function updateSelection(newIndex) {
            const items = getItems();
            if (items.length === 0) return;

            // Remove previous selection
            items.forEach(item => item.classList.remove('keyboard-focus'));

            // Wrap index
            if (newIndex < 0) newIndex = items.length - 1;
            if (newIndex >= items.length) newIndex = 0;

            selectedIndex = newIndex;
            items[selectedIndex].classList.add('keyboard-focus');

            // Scroll into view if needed
            items[selectedIndex].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
        }

        document.addEventListener('keydown', function(e) {
            const items = getItems();
            if (items.length === 0) return;

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                updateSelection(selectedIndex + 1);
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                updateSelection(selectedIndex - 1);
            } else if (e.key === 'Enter' && selectedIndex >= 0) {
                e.preventDefault();
                const link = items[selectedIndex].querySelector('a');
                if (link) window.location.href = link.href;
            }
        });

        // Clear keyboard selection on mouse click
        document.addEventListener('click', function() {
            const items = getItems();
            items.forEach(item => item.classList.remove('keyboard-focus'));
            selectedIndex = -1;
        });
    })();
    </script>

    <!-- View Transitions: Morph clicked session to card -->
    <script>
    // Track which session link was clicked for the morph effect
    let clickedSessionLink = null;

    // Capture clicks on session links
    document.addEventListener('click', function(e) {
        const sessionLink = e.target.closest('.sessions-list li a');
        if (sessionLink) {
            clickedSessionLink = sessionLink.closest('li');
        }
    });

    // pageswap: Runs on outgoing page before navigation completes
    window.addEventListener('pageswap', function(e) {
        if (!e.viewTransition) return;

        // Set transition type for forward navigation
        e.viewTransition.types.add('to-session');

        // Assign view-transition-name to clicked session for morph effect
        if (clickedSessionLink) {
            clickedSessionLink.style.viewTransitionName = 'session-card';
        }
    });

    // pagereveal: Runs on incoming page when navigating back from session
    window.addEventListener('pagereveal', function(e) {
        if (!e.viewTransition) return;

        // Check if we're coming back from a session page
        const fromUrl = navigation.activation?.from?.url;
        if (fromUrl && fromUrl.includes('session.html')) {
            // Set transition type for back navigation
            e.viewTransition.types.add('to-index');

            // Extract session file from URL to find the matching list item
            try {
                const sessionFile = new URL(fromUrl).searchParams.get('file');
                if (sessionFile) {
                    const matchingLink = document.querySelector(
                        `.sessions-list a[href*="${sessionFile}"]`
                    );
                    if (matchingLink) {
                        const li = matchingLink.closest('li');
                        li.style.viewTransitionName = 'session-card';

                        // Clean up after transition
                        e.viewTransition.finished.then(() => {
                            li.style.viewTransitionName = '';
                        });
                    }
                }
            } catch (err) {
                // Ignore URL parsing errors
            }
        }
    });
    </script>

    <!-- Three.js from CDN -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    <script type="module" src="js/sessions-3d.js"></script>
</body>
</html>
